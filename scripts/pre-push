#!/bin/bash
# Git pre-push hook - runs automatically before git push
# Installed by: cp scripts/pre-push .git/hooks/pre-push

echo "ğŸ” Running full pre-push validation..."

# Change to project root
PROJECT_ROOT="$(cd "$(dirname "$0")/.." && pwd)"
cd "$PROJECT_ROOT"

# Backend checks
echo "ğŸ“¦ Checking backend..."
cd backend

echo "  Running black..."
black --line-length 100 app/ tests/ alembic/
echo "  âœ… Black passed"

echo "  Running isort..."
isort --check-only app/ tests/ alembic/
echo "  âœ… isort passed"

echo "  Running flake8..."
flake8 --config .flake8 .
echo "  âœ… flake8 passed"

echo "  Running backend tests..."
PYTHONPATH=. python -m pytest tests/ -v --tb=short
echo "  âœ… Backend tests passed"

cd ../frontend

# Frontend checks
echo "ğŸ¨ Checking frontend..."

echo "  Running npm lint..."
npm run lint
echo "  âœ… Frontend lint passed"

echo "  Running frontend build..."
npm run build
echo "  âœ… Frontend build passed"

echo "  Running frontend unit tests..."
npm run test -- --run
echo "  âœ… Frontend unit tests passed"

echo ""
echo "âœ… All pre-push checks passed! Ready to push..."
